<IfModule rewrite_module>
  RewriteEngine on
  RewriteBase /

  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d

  RewriteCond %{QUERY_STRING} ^$ [NC]
  RewriteCond %{REQUEST_METHOD} ^GET$ [NC]
  RewriteCond %{REQUEST_URI} !(?:^|/)wp\-admin(?:/|$) [NC]
  RewriteCond %{HTTP_COOKIE} !(?:wp\-postpass_|wordpress_|comment_author_) [NC]

  RewriteCond %{HTTPS}s ^on(s)$ [NC, OR]
  RewriteCond %{HTTPS} !^on$ [NC]

  # @TODO Test Apache Mod Rewrite to see what we can do about string replacements via environment vars.
  # We need some way of doing simple string replacement here. Otherwise this is going to require a larger set of changes.
  RewriteRule .* - [E=cache_path:%{DOCUMENT_ROOT}/wp-content/cache/zencache/cache/http%1/%{HTTP_HOST}/%{REQUEST_URI}.html]

  # @TODO The real cache path needs to be set whenever this is compiled; i.e., `%%base_path_to_cache_sub_dir%%`
  RewriteCond %{DOCUMENT_ROOT}/wp-content/cache/zencache/cache/http%1/%{HTTP_HOST}/%{REQUEST_URI}.html -f

  RewriteRule .* /wp-content/cache/zencache/cache/http%1/%{HTTP_HOST}/%{REQUEST_URI}.html [L]
</IfModule>
